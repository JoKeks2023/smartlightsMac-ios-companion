# SmartLights iOS Companion - Setup Guide

This guide will help you set up and build the SmartLights iOS Companion app in Xcode.

## Prerequisites

- macOS 12.0 or later
- Xcode 14.0 or later
- An Apple Developer account (for device testing and App Groups)
- iOS 15.0+ device or Simulator

## Step-by-Step Setup

### 1. Create Xcode Project

Since this repository contains source files but not an Xcode project file, you'll need to create one:

1. **Open Xcode**

2. **Create New Project**
   - File â†’ New â†’ Project...
   - Choose "iOS" â†’ "App"
   - Click "Next"

3. **Configure Project**
   - Product Name: `SmartLightsIOSCompanion`
   - Team: Select your team
   - Organization Identifier: `com.govee` (or your own)
   - Interface: **SwiftUI**
   - Language: **Swift**
   - Storage: **None** (we handle our own persistence)
   - Click "Next"
   - Choose a location **outside** this repository folder temporarily

4. **Copy Source Files**
   - Close the newly created project
   - Copy all files from this repository into the Xcode project folder:
     ```bash
     # In the repository folder
     cp -r Sources/ SmartLightsIOSApp.swift [YourXcodeProjectFolder]/
     ```
   - Open the `.xcodeproj` file
   - Drag and drop the `Sources` folder and `SmartLightsIOSApp.swift` into the Xcode project navigator
   - Choose "Create groups" and ensure "Copy items if needed" is checked

5. **Update App Entry Point**
   - Delete the default `ContentView.swift` and `SmartLightsIOSCompanionApp.swift` files that Xcode created
   - Make sure `SmartLightsIOSApp.swift` is set as the main entry point (it has the `@main` attribute)

### 2. Configure Build Settings

1. **Minimum Deployment Target**
   - Select your project in the navigator
   - Under "Deployment Info", set iOS Deployment Target to **15.0**

2. **Swift Language Version**
   - Build Settings â†’ Swift Language Version â†’ **Swift 5**

### 3. Configure Capabilities (Optional but Recommended)

#### App Groups

To enable data sharing with the macOS app:

1. Select your target â†’ "Signing & Capabilities"
2. Click "+ Capability"
3. Add "App Groups"
4. Click "+" to add a new group
5. Enter: `group.com.govee.mac`
6. Make sure it's checked

**Note**: If you don't add App Groups, the app will work fine but use UserDefaults instead.

#### iCloud (CloudKit)

To enable cloud sync:

1. In "Signing & Capabilities"
2. Click "+ Capability"
3. Add "iCloud"
4. Check "CloudKit"
5. Click "+" to add a container
6. Enter: `iCloud.com.govee.smartlights`

**Note**: CloudKit features are currently stubs and will save locally.

#### Background Modes (Optional)

For background refresh:

1. Add "Background Modes" capability
2. Check "Background fetch"
3. Check "Remote notifications"

### 4. Build and Run

1. **Select Target Device**
   - Choose an iOS Simulator (iPhone 13 or later recommended)
   - Or connect a physical iOS device

2. **Build the Project**
   - Press `Cmd + B` or Product â†’ Build
   - Fix any build errors if they appear

3. **Run the App**
   - Press `Cmd + R` or Product â†’ Run
   - The app should launch with sample devices pre-loaded

### 5. Testing on Device

To test on a physical device:

1. **Connect your iOS device** via USB
2. **Trust the device** on your Mac if prompted
3. **Select your device** as the build target in Xcode
4. **Run** the app (Cmd + R)
5. You may need to **trust the developer** on your device:
   - Settings â†’ General â†’ VPN & Device Management
   - Trust your developer certificate

## Project Structure in Xcode

After setup, your Xcode project should look like this:

```
SmartLightsIOSCompanion/
â”œâ”€â”€ SmartLightsIOSApp.swift          # Main app entry point
â”œâ”€â”€ Sources/
â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â””â”€â”€ GoveeModels.swift
â”‚   â”œâ”€â”€ Stores/
â”‚   â”‚   â””â”€â”€ DeviceStore.swift
â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â”œâ”€â”€ CloudSyncManager.swift
â”‚   â”‚   â”œâ”€â”€ MultiTransportSyncManager.swift
â”‚   â”‚   â””â”€â”€ RemoteControlProtocol.swift
â”‚   â”œâ”€â”€ Views/
â”‚   â”‚   â”œâ”€â”€ MainTabView.swift
â”‚   â”‚   â”œâ”€â”€ DeviceListView.swift
â”‚   â”‚   â”œâ”€â”€ DeviceControlView.swift
â”‚   â”‚   â”œâ”€â”€ SettingsView.swift
â”‚   â”‚   â””â”€â”€ ConnectionStatusView.swift
â”‚   â””â”€â”€ Utils/
â”‚       â””â”€â”€ DeviceColor+Extensions.swift
â””â”€â”€ Assets.xcassets/                 # (Generated by Xcode)
```

## Troubleshooting

### Build Errors

**"Cannot find type 'X' in scope"**
- Make sure all source files are added to the target
- Check that files are in the correct groups
- Build Settings â†’ Swift Compiler - Search Paths may need adjustment

**"Ambiguous use of 'X'"**
- This usually means multiple definitions of the same type
- Make sure you deleted Xcode's default ContentView.swift

### Runtime Issues

**"App Groups not available"**
- This is expected if you haven't configured App Groups capability
- The app will fall back to UserDefaults automatically
- Check the console for: `"âš ï¸ App Groups not available, falling back to UserDefaults.standard"`

**"CloudKit not available"**
- Make sure you're signed in with an Apple ID on the device/simulator
- CloudKit features are stubs in this version anyway

**No devices appear**
- The app creates sample devices on first launch
- Try pulling down to refresh on the device list
- Check the console for initialization logs

### Simulator vs Device

**Simulator**: 
- App Groups may not work (will use UserDefaults)
- CloudKit works if you're signed in
- Local Network and Bluetooth won't work

**Device**:
- All features should work with proper entitlements
- App Groups require the capability to be enabled
- CloudKit requires iCloud sign-in

## Verification Checklist

After setup, verify everything works:

- [ ] App builds without errors
- [ ] App runs on Simulator
- [ ] Three tabs appear: Devices, Groups, Settings
- [ ] Sample devices are displayed in Devices tab
- [ ] Can toggle device power on/off
- [ ] Can open device control view
- [ ] Can adjust brightness slider
- [ ] Can change device color
- [ ] Settings tab shows configuration options
- [ ] Console shows initialization logs
- [ ] Data persists after app restart

## Next Steps

Once the basic app is running:

1. **Customize branding**: Update app icon, colors, and labels
2. **Add real devices**: Replace sample devices with actual Govee device discovery
3. **Implement CloudKit**: Replace CloudKit stubs with real CKRecord operations
4. **Add Bluetooth**: Implement CoreBluetooth scanning and control
5. **Test App Groups**: Set up the macOS app and test cross-app data sharing

## Getting Help

If you encounter issues:

1. Check the console output in Xcode for detailed logs
2. Review the inline TODO comments in the source code
3. Consult the main README.md for architecture overview
4. Open an issue on GitHub with:
   - Xcode version
   - iOS version
   - Complete error message
   - Steps to reproduce

## Advanced Configuration

### Custom App Group ID

To use a different App Group ID:

1. Update `SyncedSettings.appGroupIdentifier` default value in `GoveeModels.swift`
2. Update the App Group in Xcode capabilities
3. Update documentation references

### Custom CloudKit Container

To use a different CloudKit container:

1. Update `SyncedSettings.cloudKitContainer` default value in `GoveeModels.swift`
2. Add the container in Xcode iCloud capabilities
3. Configure the container in CloudKit Dashboard

### Adding Test Data

To add different sample devices, edit the `addSampleDevices()` method in `SmartLightsIOSApp.swift`.

## Alternative: Swift Package Manager

If you prefer to use Swift Package Manager for testing:

```bash
# Build the package (Linux/macOS)
swift build

# Run tests
swift test
```

Note: This will only build the core logic, not the full iOS app with UI.

---

**Happy coding!** ğŸ‰
